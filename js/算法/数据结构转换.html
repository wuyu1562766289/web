<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    // var data = [
    //   { name: 'a', id: 1, pid: 0 },
    //   { name: 'b', id: 2, pid: 1 },
    //   { name: 'c', id: 3, pid: 1 },
    //   { name: 'd', id: 4, pid: 2 },
    // ]
    let data =[
    {id:1,name:'部门A',pid:0},
    {id:2,name:'部门B',pid:0},
    {id:3,name:'部门C',pid:1},
    {id:4,name:'部门D',pid:1},
    {id:5,name:'部门E',pid:2},
    {id:6,name:'部门F',pid:3},
    {id:7,name:'部门G',pid:2},
    {id:9,name:'部门G',pid:10},
    {id:8,name:'部门H',pid:4}
];

    // function convert(list) {
    //   const res = []
    //   const map = list.reduce((res, v) => (res[v.id] = v, res), {})
    //   for (const item of list) {
    //     if (item.pid === 0) {
    //       res.push(item)
    //       continue
    //     }
    //     if (item.pid in map) {
    //       const parent = map[item.pid]
    //       parent.children = parent.children || []
    //       parent.children.push(item)
    //     }
    //   }
    //   return res
    // }


    function convert(data) {
      let list = [];
      let map = data.reduce((map, v) => {
        map[v.id] = v;
        return map;
      }, {});

      for(let item of data) {
        if(item.pid === 0) {
          list.push(item);
          continue;
        }
        if(item.pid in map) {
          let parent = map[item.pid];
          parent.children = parent.children || [];
          parent.children.push(item);
        }
      }
      return list;
    }
    console.log(convert(data));
  </script>
</body>

</html>